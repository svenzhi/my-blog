import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as n,b as e,o as i}from"./app-MYkrhbSD.js";const p="/assets/FBFLDDBRDDBRFD-1-a-kGOZyP.png",l="/assets/FBFLDDBRDDBRFD-2-D_G31r_j.png",r="/assets/FBFLDDBRDDBRFD-3-PF8cNHnI.png",t={};function o(c,s){return i(),n("div",null,[...s[0]||(s[0]=[e(`<blockquote><p>博主有两三个长期使用的自建站点，近日想加一个流量统计脚本，体验了几个云厂商的都不甚满意，偶然发现了<a href="https://umami.is/" target="_blank" rel="noopener noreferrer">Umami</a>。</p><p>它是一个开源的网络分析工具，提供了关于网站流量、用户行为和性能的数据统计与可视化分析功能，并且拥有极简的UI风格。</p><p>试用了官方的Demo后，让博主甚是喜欢，便决定使用Docker部署Umami。</p></blockquote><h2 id="部署" tabindex="-1"><a class="header-anchor" href="#部署"><span>部署</span></a></h2><blockquote><p>Umami官方提供了Docker镜像，但同时需要搭配数据库使用，这样一来，还是使用docker compose更方便一点，博主的<code>docker-compose.yml</code>如下。</p><p>更多环境变量配置可见官方文档：<a href="https://umami.is/docs/environment-variables" target="_blank" rel="noopener noreferrer">https://umami.is/docs/environment-variables</a></p><p>注意：博主使用的是2.19版本，本文发布时，官方发布了最新的V3版本，且不再支持MySQL，大家下载镜像时记得区分，官方V3更新说明见<a href="https://umami.is/blog/umami-v3" target="_blank" rel="noopener noreferrer">Umami v3 </a></p></blockquote><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>services:</span></span>
<span class="line"><span>  umami:</span></span>
<span class="line"><span>    image: ghcr.io/umami-software/umami:postgresql-v2.19.0</span></span>
<span class="line"><span>    ports:</span></span>
<span class="line"><span>      - &quot;9012:3000&quot;</span></span>
<span class="line"><span>    environment:</span></span>
<span class="line"><span>      DATABASE_URL: postgresql://umami:umami@db:5432/umami</span></span>
<span class="line"><span>      DATABASE_TYPE: postgresql</span></span>
<span class="line"><span>      APP_SECRET: &quot;string&quot; # 自定义的密钥</span></span>
<span class="line"><span>      TRACKER_SCRIPT_NAME: my-analytics.js # 自定义脚本名称</span></span>
<span class="line"><span>    depends_on:</span></span>
<span class="line"><span>      db:</span></span>
<span class="line"><span>        condition: service_healthy</span></span>
<span class="line"><span>    restart: always</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  db:</span></span>
<span class="line"><span>    image: postgres:15-alpine</span></span>
<span class="line"><span>    environment:</span></span>
<span class="line"><span>      POSTGRES_DB: umami</span></span>
<span class="line"><span>      POSTGRES_USER: umami</span></span>
<span class="line"><span>      POSTGRES_PASSWORD: umami</span></span>
<span class="line"><span>    volumes:</span></span>
<span class="line"><span>      - ./umami-db-data:/var/lib/postgresql/data</span></span>
<span class="line"><span>    restart: always</span></span>
<span class="line"><span>    healthcheck:</span></span>
<span class="line"><span>      test: [&quot;CMD-SHELL&quot;, &quot;pg_isready -U $\${POSTGRES_USER} -d $\${POSTGRES_DB}&quot;]</span></span>
<span class="line"><span>      interval: 5s</span></span>
<span class="line"><span>      timeout: 5s</span></span>
<span class="line"><span>      retries: 5</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>容器运行成功之后，便可以登录了。<br> 默认用户名：admin<br> 密码：umami<br><img src="`+p+'" alt="" loading="lazy"></p></blockquote><h2 id="站点统计添加、管理" tabindex="-1"><a class="header-anchor" href="#站点统计添加、管理"><span>站点统计添加、管理</span></a></h2><blockquote><p>登录之后，点击 <code>设置-网站-添加网站</code>填写站点名称与站点地址，便可以获得统计代码。<br> 将代码放到需统计站点合适的页面位置，就可以做到流量统计啦。</p></blockquote><figure><img src="'+l+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="反代配置" tabindex="-1"><a class="header-anchor" href="#反代配置"><span>反代配置</span></a></h2><p>若部署后后发现不能获取IP省市信息，可以参考如下反代配置.</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>location ^~ / {</span></span>
<span class="line"><span>    proxy_pass http://127.0.0.1:9012; </span></span>
<span class="line"><span>    proxy_set_header Host $host; </span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>    proxy_set_header REMOTE-HOST $remote_addr; </span></span>
<span class="line"><span>    proxy_set_header Upgrade $http_upgrade; </span></span>
<span class="line"><span>    proxy_set_header Connection $http_connection; </span></span>
<span class="line"><span></span></span>
<span class="line"><span>    proxy_set_header X-Forwarded-Port $server_port; </span></span>
<span class="line"><span>    proxy_http_version 1.1; </span></span>
<span class="line"><span>    add_header X-Cache $upstream_cache_status; </span></span>
<span class="line"><span>    add_header Cache-Control no-cache; </span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>    proxy_ssl_name $proxy_host; </span></span>
<span class="line"><span>    add_header Strict-Transport-Security &quot;max-age=31536000&quot;; </span></span>
<span class="line"><span></span></span>
<span class="line"><span>    proxy_buffering on;</span></span>
<span class="line"><span>    proxy_ssl_session_reuse off;</span></span>
<span class="line"><span>    proxy_ssl_server_name on;</span></span>
<span class="line"><span>    proxy_set_header X-Forwarded-Proto https;</span></span>
<span class="line"><span>    proxy_set_header X-Real-IP $remote_addr;</span></span>
<span class="line"><span>    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span>    proxy_set_header X-Forwarded-Host  $host;</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="深入配置-站点跟踪配置细节" tabindex="-1"><a class="header-anchor" href="#深入配置-站点跟踪配置细节"><span>深入配置：站点跟踪配置细节</span></a></h2><p>Umami还支持对站点统计的一些细节做配置，如排除链接参数、避免页面哈希变化导致访问量统计失真、函数回调、以及数据标签（这个很不错，可以做简单的页面埋点区分）等功能。</p><p>大家可以参考<a href="https://umami.is/docs/tracker-configuration" target="_blank" rel="noopener noreferrer">跟踪器配置 --- Tracker configuration</a>。</p><blockquote><p>UI展示</p></blockquote><figure><img src="`+r+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>',16)])])}const v=a(t,[["render",o]]),u=JSON.parse('{"path":"/posts/daily/umami-deploy-with-docker-compose.html","title":"Docker部署Umami：自建Umai实现站点流量统计+可视化数据分析","lang":"zh-CN","frontmatter":{"author":null,"title":"Docker部署Umami：自建Umai实现站点流量统计+可视化数据分析","date":"2025-11-08T00:00:00.000Z","icon":null,"cover":"/assets/posts/FBFLDDBRDDBRFD-cover2.png","order":null,"category":["daily"],"tags":["Umami","Docker部署"],"footer":null,"copyright":null,"sticky":false,"star":false,"uid":"FBFLDDBRDDBRFD","imageNameKey":"FBFLDDBRDDBRFD","description":"博主有两三个长期使用的自建站点，近日想加一个流量统计脚本，体验了几个云厂商的都不甚满意，偶然发现了Umami。 它是一个开源的网络分析工具，提供了关于网站流量、用户行为和性能的数据统计与可视化分析功能，并且拥有极简的UI风格。 试用了官方的Demo后，让博主甚是喜欢，便决定使用Docker部署Umami。 部署 Umami官方提供了Docker镜像，但...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Docker部署Umami：自建Umai实现站点流量统计+可视化数据分析\\",\\"image\\":[\\"https://blog.itsven.cn/assets/posts/FBFLDDBRDDBRFD-cover2.png\\"],\\"datePublished\\":\\"2025-11-08T00:00:00.000Z\\",\\"dateModified\\":\\"2025-11-22T10:19:53.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"itsven\\",\\"url\\":\\"https://blog.itsven.cn\\"}]}"],["meta",{"property":"og:url","content":"https://blog.itsven.cn/posts/daily/umami-deploy-with-docker-compose.html"}],["meta",{"property":"og:site_name","content":"itsven"}],["meta",{"property":"og:title","content":"Docker部署Umami：自建Umai实现站点流量统计+可视化数据分析"}],["meta",{"property":"og:description","content":"博主有两三个长期使用的自建站点，近日想加一个流量统计脚本，体验了几个云厂商的都不甚满意，偶然发现了Umami。 它是一个开源的网络分析工具，提供了关于网站流量、用户行为和性能的数据统计与可视化分析功能，并且拥有极简的UI风格。 试用了官方的Demo后，让博主甚是喜欢，便决定使用Docker部署Umami。 部署 Umami官方提供了Docker镜像，但..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://blog.itsven.cn/assets/posts/FBFLDDBRDDBRFD-cover2.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-11-22T10:19:53.000Z"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://blog.itsven.cn/assets/posts/FBFLDDBRDDBRFD-cover2.png"}],["meta",{"name":"twitter:image:alt","content":"Docker部署Umami：自建Umai实现站点流量统计+可视化数据分析"}],["meta",{"property":"article:tag","content":"Docker部署"}],["meta",{"property":"article:tag","content":"Umami"}],["meta",{"property":"article:published_time","content":"2025-11-08T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-11-22T10:19:53.000Z"}]]},"git":{"createdTime":1762572706000,"updatedTime":1763806793000,"contributors":[{"name":"svenzhi","username":"svenzhi","email":"svenzhi@163.com","commits":3,"url":"https://github.com/svenzhi"}],"changelog":[{"hash":"b4dc5d8221cb2e05feccccc3004776f48e2bbd9c","time":1763806793000,"email":"svenzhi@163.com","author":"svenzhi","message":"更新标签"},{"hash":"32debd881170003a62b22a3d572b35112f10ce28","time":1763806421000,"email":"svenzhi@163.com","author":"svenzhi","message":"更新文章"},{"hash":"eed8271ffb619ab9d8afcb940d66081823d4ef89","time":1762572706000,"email":"svenzhi@163.com","author":"svenzhi","message":"更新文章分类与标签"}]},"readingTime":{"minutes":2.25,"words":674},"filePathRelative":"posts/daily/umami-deploy-with-docker-compose.md","excerpt":"<blockquote>\\n<p>博主有两三个长期使用的自建站点，近日想加一个流量统计脚本，体验了几个云厂商的都不甚满意，偶然发现了<a href=\\"https://umami.is/\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">Umami</a>。</p>\\n<p>它是一个开源的网络分析工具，提供了关于网站流量、用户行为和性能的数据统计与可视化分析功能，并且拥有极简的UI风格。</p>\\n<p>试用了官方的Demo后，让博主甚是喜欢，便决定使用Docker部署Umami。</p>\\n</blockquote>\\n<h2>部署</h2>\\n<blockquote>\\n<p>Umami官方提供了Docker镜像，但同时需要搭配数据库使用，这样一来，还是使用docker compose更方便一点，博主的<code>docker-compose.yml</code>如下。</p>\\n<p>更多环境变量配置可见官方文档：<a href=\\"https://umami.is/docs/environment-variables\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://umami.is/docs/environment-variables</a></p>\\n<p>注意：博主使用的是2.19版本，本文发布时，官方发布了最新的V3版本，且不再支持MySQL，大家下载镜像时记得区分，官方V3更新说明见<a href=\\"https://umami.is/blog/umami-v3\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">Umami v3 </a></p>\\n</blockquote>","autoDesc":true}');export{v as comp,u as data};
